<div class="main-content">
    <!-- Tarjeta de Temperatura -->
    <div class="card">
        <h2>Temperatura</h2>
        <div class="main-value" id="currentTemperature">--</div>
        <div class="value-unit">°C</div>
        <div class="chart-container">
            <canvas id="temperatureChart"></canvas>
        </div>
    </div>
    <!-- Tarjeta de Humedad -->
    <div class="card">
        <h2>Humedad</h2>
        <div class="main-value" id="currentHumidity">--</div>
        <div class="value-unit">%</div>
        <div class="chart-container">
            <canvas id="humidityChart"></canvas>
        </div>
    </div>
    <!-- Tarjeta de Calidad de Aire -->
    <div class="card">
        <h2>Calidad de Aire</h2>
        <div class="main-value" id="currentAirQuality">--</div>
        <div class="value-unit">Valor MQ135</div>
        <div class="chart-container">
            <canvas id="airQualityChart"></canvas>
        </div>
    </div>
    <!-- Tarjeta de Información del Sistema -->
    <div class="card">
        <h2>Información del Sistema</h2>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Dirección IPv6:</div>
                <div class="info-value" id="ipv6Address">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">Timestamp:</div>
                <div class="info-value" id="timestamp">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">Cliente ID:</div>
                <div class="info-value" id="clientIdDisplay">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">Estado:</div>
                <div class="info-value" id="systemStatus">Conectando...</div>
            </div>
        </div>
    </div>
</div>
<script>
    // Variables globales
    let ws = null;
    let isMonitoring = false;
    let clientId = Math.random().toString(36).substr(2, 9);

    // Función para conectar WebSocket
    function connectWebSocket() {
        const wsUrl = `ws://localhost:8000/ws`;
        ws = new WebSocket(wsUrl);

        ws.onopen = function() {
            updateConnectionStatus(true);
            document.getElementById('sensorStatus').classList.add('connected');
        };
        ws.onclose = function() {
            updateConnectionStatus(false);
            document.getElementById('sensorStatus').classList.remove('connected');
            setTimeout(connectWebSocket, 3000);
        };
        ws.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                updateUI(data);
            } catch (error) {}
        };
    }

    // Función para actualizar valores principales de las tarjetas
    function updateUI(data) {
        // El backend debe enviar los campos: temperature, humidity, air_quality, ipv6_address, timestamp
        document.getElementById('currentTemperature').textContent = data.temperature !== null ? data.temperature.toFixed(1) : '--';
        document.getElementById('currentHumidity').textContent = data.humidity !== null ? data.humidity.toFixed(1) : '--';
        document.getElementById('currentAirQuality').textContent = data.air_quality !== null ? data.air_quality : '--';
        document.getElementById('ipv6Address').textContent = data.ipv6_address || '--';
        document.getElementById('timestamp').textContent = data.timestamp ? new Date(data.timestamp).toLocaleString('es-ES') : '--';
        document.getElementById('clientIdDisplay').textContent = clientId;
        document.getElementById('clientId').textContent = clientId;
        document.getElementById('systemStatus').textContent = 'Conectado';
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
    }

    function updateConnectionStatus(connected) {
        const statusIndicator = document.getElementById('connectionStatus');
        const systemStatus = document.getElementById('systemStatus');
        if (connected) {
            statusIndicator.classList.add('connected');
            systemStatus.textContent = 'Conectado';
            systemStatus.style.color = '#10b981';
        } else {
            statusIndicator.classList.remove('connected');
            systemStatus.textContent = 'Desconectado';
            systemStatus.style.color = '#ef4444';
        }
    }

    // Eventos de botones (puedes dejar solo el básico para iniciar)
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('startBtn').onclick = function() {
            if (!isMonitoring) {
                isMonitoring = true;
                connectWebSocket();
                this.classList.add('active');
            }
        };
        document.getElementById('stopBtn').onclick = function() {
            if (isMonitoring) {
                isMonitoring = false;
                if (ws) ws.close();
                document.getElementById('startBtn').classList.remove('active');
            }
        };
        updateConnectionStatus(false);
        document.getElementById('sensorStatus').classList.remove('connected');
    });
</script>
